<!doctype html><html><head><title>Fast Fourier transform (FFT) using WebAssembly with twr-wam</title><meta name="description" content="JavaScript/TypeScript calls the KISS FFT library using WebAssembly and then graphs input and output."><script type="module" src="/examples/dist/lib-js.39a0d54e.js"></script><script type="importmap">
	{
		"imports": {
		"twr-wasm": "../../lib-js/index.js"
		}
	}
	</script></head><body style="background-color:#fff"> <h1>Fast Fourier transform (FFT) using WebAssembly with twr-wasm</h1> This example generates an input signal using JavaScript that is the sum of 1K and 5K sin waves. The <a href="https://github.com/mborgerding/kissfft">KISS FFT C library</a> is then called to generate the FFT. This is done using WebAssembly to incorporate the C library into the HTML web page. The output from the FFT is then also graphed using JavaScript. <ul> <li>source code: <a href="https://github.com/twiddlingbits/twr-wasm/tree/main/examples/fft">here on github</a></li> <li>view <a href="https://twiddlingbits.dev/docsite/examples/examples-overview/">more examples here</a></li> </ul> <br> <div style="font:24px arial">Input Signal</div> <canvas id="c-input" width="1024" height="300" style="background-color:#d3d3d3"></canvas> <br><br><br> <div style="font:24px arial">FFT Output</div> <canvas id="c-output" width="1024" height="300" style="background-color:#d3d3d3"></canvas> <script type="module">var t=globalThis,e={},r={},n=t.parcelRequire8dfc;null==n&&((n=function(t){if(t in e)return e[t].exports;if(t in r){var n=r[t];delete r[t];var i={id:t,exports:{}};return e[t]=i,n.call(i.exports,i,i.exports),i.exports}var l=Error("Cannot find module '"+t+"'");throw l.code="MODULE_NOT_FOUND",l}).register=function(t,e){r[t]=e},t.parcelRequire8dfc=n),n.register;var i=n("57pKS");async function l(){let t=new i.twrWasmModule;await t.loadWasm("kiss_fft.wasm");let e=new a(1024,48e3);e.genSin(1e3),e.addSin(5e3),e.graphIn("c-input");let r=await t.callC(["kiss_fft_alloc",e.nfft,0,0,0]);await t.callC(["kiss_fft",r,e.inArrayBuf,e.outArrayBuf]),e.graphOut("c-output"),await t.callC(["free",r])}class a{nfft;sampleRate;scaleIn;inArrayBuf;in;outArrayBuf;out;constructor(t,e){this.nfft=t,this.sampleRate=e,this.scaleIn=0,this.inArrayBuf=new ArrayBuffer(8*t),this.in=new Float32Array(this.inArrayBuf);for(let e=0;e<2*t;e++)this.in[e]=0;this.outArrayBuf=new ArrayBuffer(8*t),this.out=new Float32Array(this.outArrayBuf)}degToRad(t){return 2*t*Math.PI/360}setInReal(t,e){this.in[2*t]=e}getInReal(t){return this.in[2*t]}getOutReal(t){let e=this.out[2*t],r=this.out[2*t+1];return Math.sqrt(e*e+r*r)}genSin(t){this.scaleIn=1;for(let e=0;e<this.nfft;e++){let r=2*Math.PI*t*(e/this.sampleRate);this.setInReal(e,Math.sin(r))}}addSin(t){this.scaleIn++;for(let e=0;e<this.nfft;e++){let r=2*Math.PI*t*(e/this.sampleRate),n=this.getInReal(e);this.setInReal(e,n+Math.sin(r))}}graphIn(t){let e=document.getElementById(t);if(!e)throw Error("canvas ID "+t+" not found");if(!e.getContext)throw Error("unexpected error: canvas.getContext is null");let r=e.getContext("2d");if(!r)throw Error("unexpected null context");let n=e.height/2,i=e.width,l=e.height/2/this.scaleIn,a=i/this.nfft;r.fillStyle="green",r.strokeStyle="blue",r.lineWidth=3,r.beginPath(),r.moveTo(0,n),r.lineTo(i,n),r.stroke(),r.strokeStyle="black";let o=n+this.getInReal(0)*l;r.moveTo(0,o),r.beginPath();for(let t=1;t<this.nfft;t++){let e=t*a,i=n+this.getInReal(t)*l;r.lineTo(e,i)}r.stroke()}graphOut(t){let e=document.getElementById(t);if(!e)throw Error("canvas ID "+t+" not found");if(!e.getContext)throw Error("unexpected error: canvas.getContext is null");let r=e.getContext("2d");if(!r)throw Error("unexpected null context");let n=e.width,i=n/this.nfft;r.fillStyle="green",r.strokeStyle="blue",r.lineWidth=3,r.beginPath(),r.moveTo(0,e.height),r.lineTo(n,e.height),r.stroke(),r.strokeStyle="black",r.beginPath();for(let t=0;t<this.nfft;t++){let n=t*i;r.moveTo(n,e.height);let l=e.height-this.getOutReal(t)/this.nfft*e.height;r.lineTo(n,l)}r.stroke()}}l();</script> </body></html>